name: Validate PR Changes

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  check-files:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Get list of changed files
        id: changes
        run: |
          echo "CHANGED=$(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }})" >> $GITHUB_ENV

      - name: Validate only quotes.json changed
        run: |
          ALLOWED_FILE="backend/quotes.json"
          echo "Changed files: ${CHANGED}"

          for FILE in ${CHANGED}; do
            if [ "$FILE" != "$ALLOWED_FILE" ]; then
              echo "❌ Invalid file changed: $FILE"
              echo "Only $ALLOWED_FILE can be modified in PRs."
              exit 1
            fi
          done

          echo "✅ All changes are valid."
